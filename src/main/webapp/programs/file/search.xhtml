<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui">
    <ui:composition>
        <link type="text/css" rel="stylesheet" href="#{request.contextPath}/programs/file/search.css" />
        
        <h:panelGroup layout="block" id="search-main">
            <h:form id="search-form">
                <h:panelGrid columns="2" columnClasses="search-panel,search-panel">
                    <h:panelGroup layout="block" id="search-criteria">
                        <p:panelGrid id="search-criteria-table" columns="2" columnClasses="criteria-columns">
                            <f:facet name="header">Search Criteria</f:facet>

                            <p:outputLabel value="Filename: " />
                            <p:inputText id="filename" styleClass="search-input">
                                <p:ajax update="search-results-list" listener="#{ProgramFile.newEntitySearch.search}"
                                        />
                            </p:inputText>

                            <p:outputLabel value="Uploaded since: " />
                            <p:calendar pattern="dd.MM.yyyy" styleClass="search-input" />

                            <p:outputLabel value="Uploaded before: " />
                            <p:calendar pattern="dd.MM.yyyy" styleClass="search-input"  />

                            <f:facet name="footer"> 
                                <p:commandButton id="search-button" value="Search" update="search-results-list" 
                                                 action="#{ProgramFile.newEntitySearch.search}"
                                                 />
                                <p:commandButton id="reset-button" value="Reset" update="search-results-list" 
                                                 action="#{ProgramFile.newEntitySearch.reset}" 
                                                 />
                            </f:facet> 
                        </p:panelGrid>
                    </h:panelGroup>
                    
                    <h:panelGroup layout="block" id="search-results" style="">
                        <p:blockUI block="search-results" trigger="search-button,reset-button">
                            <img src="#{request.contextPath}/programs/file/ajax_loader.gif" class="ajax-large" />
                        </p:blockUI>
                        <p:panelGrid id="search-results-table" columns="1" style="width: 305px;">
                            <f:facet name="header">Search Result</f:facet>

                            <p:accordionPanel id="search-results-list" var="file" 
                                              value="#{ProgramFile.newEntitySearch.results}"  
                                              style="width: 100%;overflow: scroll; height: 400px;"
                                               >
                                <p:tab title="#{file.FILENAME} - Uploaded by #{file.CREATED_BY} on the #{file.DATE_CREATED}">

                                    <p:commandButton value="Manage File/Sequences" update=":subprogram" id="manage"  
                                        styleClass="ui-priority-primary"
                                        action="#{ProgramFile.manageFileAndSequences()}">
                                        <f:setPropertyActionListener target="#{ProgramFile.subprogram}" 
                                                                     value="manage" />
                                        <f:setPropertyActionListener target="#{ProgramFile.subprogramTitle}" 
                                                                     value="Manage File/Sequences" />
                                        <f:setPropertyActionListener target="#{ProgramFile.selectedEU}" 
                                                                     value="#{file}" />
                                    </p:commandButton>
                                    <p:commandButton value="Generate Sequences" update=":subprogram" id="Generate"
                                                     styleClass="ui-priority-primary">
                                        
                                    </p:commandButton>
                                    <p:commandButton value="Reset File" />
                                    <p:blockUI block=":subprogram" trigger="manage" />
                                </p:tab>
                            </p:accordionPanel>
                        </p:panelGrid>
                    </h:panelGroup>
                    
                </h:panelGrid>
            </h:form>
            <h:panelGroup id="uploader" layout="block">
                <h:form id="upload-form" enctype="multipart/form-data">
                    <p:outputLabel id="messages-label" value="#{FileUploader.startUpload} " />
                    <p:messages id="messages" showDetail="true" autoUpdate="true" closable="true"/>
                    <p:fileUpload fileUploadListener="#{FileUploader.uploadFile}" immediate="true" 
                                  mode="advanced" auto="true"
                                  sizeLimit="10000000000" allowTypes="/(\.|\/)(TXT|txt|jpe?g|csv)$/"
                                  label="Upload File"
                                  >
                    </p:fileUpload>
                    <h:commandButton id="insert-file-button" value="Insert" action="#{FileUploader.insertFileAndSequences}" 
                                     />
                    
                    
                </h:form>
            </h:panelGroup>
        </h:panelGroup>
    </ui:composition>
</html>
